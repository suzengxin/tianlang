<!DOCTYPE html>
<html lang="zh">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
	<title>系统管理_天狼云</title>
	
	<!-- jQuery(Bootstrap的JavaScript插件需要引入jQuery，务必在bootstrap.min.js之前引入) -->
	<script src="https://suzengxin.github.io/static/jquery-3.5.1.min.js"></script>
	
	<!-- 最新版本的 Bootstrap 核心 CSS 文件 -->
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css" data-integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" data-crossorigin="anonymous">
	
	<!-- 最新的 Bootstrap 核心 JavaScript 文件 -->
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min.js" data-integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" data-crossorigin="anonymous"></script>
	
	<!-- 可选的 Bootstrap 主题文件（一般不用引入） -->
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap-theme.min.css" data-integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" data-crossorigin="anonymous">
	
	<link href="https://suzengxin.github.io/static/common.css" rel='stylesheet' type='text/css' />
	<script src="https://suzengxin.github.io/static/common.js"></script>

	<!-- 图标 -->
	<link rel="shortcut icon" href="https://suzengxin.github.io/images/favicon.ico">  
	<link rel="Bookmark" href="https://suzengxin.github.io/images/favicon.ico">
</head>

<body>
<div class="container-fluid">
	<!-- 导航 -->
	<div id="nav_load" class="navbar navbar-inverse" role="navigation" style="margin: 0px;"></div>
	
	<div id="content">
		<div class="row">
			<div class="col-xs-12">
				<div class="container-fluid">
					<div id="logo" class="jumbotron">
						<h1 class="text-center"><a href="/config">天狼云<span>系统管理</span></a></h1>
					</div>
				</div>
			</div>
		</div>
	
		<div class="row">
			<div class="col-xs-8 col-xs-offset-2">
				<div class="panel panel-default">
				    <div class="panel-heading">
				        <h3 class="panel-title text-center">
				           	 书籍管理
				        </h3>
				    </div>
			    	<div class="row">
		    			<div class="panel-body text-center">
			        		<button class="btn btn-success btn-xs" data-toggle="modal" data-target="#uploadBook">上传书籍</button>
			    		</div>
			    	</div>
				</div>
			</div>
		</div>
	</div>
</div>

<!-- 模态框（Modal） -->
<div class="modal fade" id="uploadBook" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title" id="myModalLabel">上传书籍</h4>
            </div>
            <div class="modal-body" style="height: 220px;">
				<form role="form" id="form" enctype="multipart/form-data">
					<div class="form-group">
						<label for="author" class="col-xs-4 control-label">作者</label>
					    <div class="col-xs-8">
					    	<input type="text" name="author" id="author" class="form-control" placeholder="作者名称">
					    </div>
					</div>
					<div class="form-group">
						<label for="book" class="col-xs-4 control-label">书籍名称</label>
					    <div class="col-xs-8">
					    	<input type="text" name="book" id="book" class="form-control" placeholder="书籍名称">
					    </div>
					</div>
					<div class="form-group">
						<label for="file" class="col-xs-4 control-label">书籍文件</label>
					    <div class="col-xs-8">
					    	<input type="file" name="file" id="file">
					    </div>
					</div>
				</form>
			</div>
            <div class="modal-footer">
                <button class="btn btn-default" data-dismiss="modal">关闭</button>
                <button class="btn btn-primary" onclick="uploadBook()">上传</button>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal -->
</div>


<!-- 模态框（Modal） -->
<div class="modal fade" id="uploadModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">                            
            <div class="modal-body">
                <div id='modal_message' style="text-align: center"><h2>正在上传中.....</h2></div>
                <div class="progress progress-striped active">
                    <div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="60" 
                        aria-valuemin="0" aria-valuemax="100" style="width: 100%;">
                        <span class="sr-only">100% 完成</span>
                    </div>
                </div>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal -->
</div>

<div id="myAlert" class="alert alert-success hidden">
	<a href="#" class="close" data-dismiss="alert">&times;</a>
	<h2 id="msg" style="text-align: center;">成功</h2>
	<button class="btn btn-success" data-dismiss="alert" style="margin: 10%;float: right;">确认</button>
</div>
</body>

<style type="text/css">
	#myAlert {
		width: 40%;
		height: 40%;
		position:fixed;
	    top:7%;
	    right:0;
	    left:0;
	    margin:auto; 
	}
	#msg {
		margin-top: 10%;
	}
</style>

<script type="text/javascript">
	$(function(){
		removeNavActive();
		$("#nav_setup").addClass("active");
		
		$("#myAlert").bind('closed.bs.alert', function () {
			location.href = "/config";
		});
	})
	
	//居中模态框
	$('#uploadBook').on('shown.bs.modal', function () {
	    var $this = $(this);
	    var dialog = $this.find('.modal-dialog');
	    var top = ($(window).height() - dialog.height()) / 2;
	    dialog.css({
	        marginTop:top
	    });
	});
	
	function uploadBook () {
		$("#uploadModal").modal("show");
		$("#uploadBook").modal("hide");
		var formData = new FormData($('#form')[0]);
		$.ajax({
            url: "/config/book/upload",
            type: "POST",
            data: formData,
            cache: false,
            traditional: true,
            /**
             *必须false才会自动加上正确的Content-Type
             */
            contentType: false,
            /**
             * 必须false才会避开jQuery对 formdata 的默认处理
             * XMLHttpRequest会对 formdata 进行正确的处理
             */
            processData: false,
            success: function (data) {
            	$("#uploadModal").modal("hide");
            	$('#uploadModal').on('hidden.bs.modal', function () {
            		$("#msg").empty();
            		$("#msg").append(data.msg);
            		if (data.status == "1") {
            			$("#myAlert").attr("class","alert alert-success");
            		};
            		if (data.status == "0") {
            			$("#myAlert").attr("class","alert alert-danger");
            		};
            	})
            },
            error: function (data) {
                if(data){
                	$("#uploadModal").modal("hide");
                	$('#uploadModal').on('hidden.bs.modal', function () {
                		$("#msg").empty();
                		$("#msg").append(data.msg);
                		$("#myAlert").attr("class","alert alert-danger");
                	})
                }
            }
        });
	}
</script>
</html>